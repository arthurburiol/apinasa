<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Imagens Astronômicas do Dia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <!--NAV BAR-->
    <nav class="navbar fixed-top">
        <div class="container-fluid">
            <img src="images/logo.png" alt="" style="width: 60px; height: auto;">
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasNavbarLabel">NASA</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                        <li class="nav-item">
                            <a class="nav-link" href="index.html">Página Inicial</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="ceu.html">Imagens Astronômicas do Dia</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="asteroides.html">Monitoramento de Asteroides</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="marte.html">Explorando Marte</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="logs.html">Logs</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container">
        <h2>Imagens Astronômicas do Dia</h2>
        <div id="alert"></div>
        <div id="apodContainer" class=""></div>
        <button class="btn btn-primary" onclick="carregarImagemAstronomica()">Mostrar Imagem</button>
        <div id="logs-container" class="mt-4" style="display: none;"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        const matricula = "414271";

        async function carregarImagemAstronomica() {
            const apiUrl = "https://api.nasa.gov/planetary/apod?api_key=phQwzgOt5Lwhd6Gn3gJBJFiv3qHnXBkBRkMIOgBR";
            try {
                const res = await fetch(apiUrl);
                const data = await res.json();
                console.log(data);
                displayImage(data);
                registrarLog('Imagem Astronomica', 'Imagem Astronômica carregada');
            } catch (error) {
                mostrarAlerta('Erro ao buscar a imagem: ' + error.message);
            }
        }

        function displayImage(data) {
            const card = `
                <div class="col-lg-12 mb-4">  
                    <div class="card">
                        <img src="${data.url}" class="card-img-top" alt="${data.title}">
                        <div class="card-body">
                            <h5 class="card-title">${data.title}</h5>
                            <p class="card-text">${data.explanation}</p>
                        </div>
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">Criador: ${data.copyright}</li>
                            <li class="list-group-item">Data: ${data.date}</li>
                        </ul>
                    </div>
                </div>`;

            const div = document.getElementById("apodContainer");
            div.innerHTML = card;
        }

        function mostrarAlerta(msg) {
            const alert = document.createElement("div");
            alert.innerHTML = msg;
            alert.classList.add("alert", "alert-danger", "mt-3");
            document.querySelector("#alert").innerHTML = '';
            document.querySelector("#alert").appendChild(alert);
        }

        async function registrarLog(metodo, retorno) {
            const urlLogs = `https://www.piway.com.br/unoesc/api/inserir/log/${matricula}/NASA/${metodo}/${retorno}`;
            try {
                const response = await fetch(urlLogs);
                if (!response.ok) {
                    throw new Error('Erro ao registrar log.');
                }
            } catch (error) {
                console.error('Erro ao registrar log:', error.message);
            }
        }

    </script>
</body>

</html>